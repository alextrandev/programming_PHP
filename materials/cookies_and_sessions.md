##### Using cookies

All cookies are saved in the $\_COOKIE array. They are read just like with any other array (array_name[key]), but setting them requires a separate function. Like $\_GET and $\_POST, $\_COOKIE is more or less a read-only array – although technically adding values the “traditional way” may not throw errors, the results are unpredictable at best.

Note: Cookies are sent in the HTTP message headers, so if you want to set a cookie, this must be done before any HTML (or other output) is written on the page. If there is any output, you will get the error “headers already sent”. Doing whatever else with PHP first is fine. (If you’re certain you’re not outputting anything before setting the cookie and it’s still giving errors, make sure there’s no blank lines before the <?php tag. Other error messages generated by PHP are also output.)

### Setting a cookie

A cookie is created and modified (overwritten) with setcookie function. It can be given a total of seven parameters, but most of them are optional. Only the first three are used in most situations. The rest are related to scope (where the cookie may be accessed) and extra security (see e.g. W3Schools).

```php
setcookie(name, value, expire, path, domain, secure, httponly);
```

”name” is the name of the cookie, in other words the key in the $\_COOKIE array. (mandatory)
“value” is the value of the cookie, i.e. the contents of the array slot. It can only be a string. Arrays and objects must be turned into strings before they can be used as cookie values.
“expire” tells when the cookie expires. The default is 0, i.e. the cookie expires as soon as the browser is closed. Note that this is the time, not duration. You need to use the current time in the calculation. E.g. time()+86400*30, will set the cookie to expire in 30 days (86400 * 30 seconds).

```php
setcookie("favorite_programming_language", "PHP", time()+86400); // expires in one day

// Setting the “expire” time to the past (e.g. time() – 60) causes the cookie to expire immediately. It doesn’t matter what value you give it ("" is just fine), but there must be a value since the parameters are read from first to last.

setcookie("favorite_programming_language", "", time() - 60);
```

### Reading cookies

First, it’s not guaranteed that the cookie exists when you want to read it. The user can delete any files, including cookies, in their device at any time. Always check first. This can be done with isset function. The function returns true if the parameter variable exists – in this case if the $\_COOKIE array contains the key “favorite_programming_language”.

```php
if (isset($_COOKIE["favorite_programming_language"])) {
    // do something with the cookie
}

//Once it’s confirmed that the cookie exists, reading it is a simple matter. When it comes to reading values, $_COOKIE is just an associative array.

if (isset($_COOKIE["favorite_programming_language"])) {
    $language = $_COOKIE["favorite_programming_language"];
    print "Your favorite programming language is $language.";
} else {
    print "You haven't chosen a favorite programming language.";
}
```

##### Using sessions

Sessions must always be first opened with session_start(). If there already is a session for this visit (i.e. same user and the browser has not been closed or the session destroyed), the current session is opened. If there isn’t, then a new session is created. Without this function call, the $\_SESSION array – the way to access session variables – is not in use.

Compared to $\_GET, $\_POST and $\_COOKIE, using $\_SESSION is really straightforward. As long you remember to start the session before trying to use $\_SESSION, it’s a completely regular array. You can set values and read values exactly like with any associative array. Note: Setting a new value with the same key overwrites the old value.

### Setting a session variable

```php
session_start();
$_SESSION['favorite_programming_language'] = "PHP";
print "Favorite programming language set.";

// Reading a session variable
session_start();
print "Your favorite programming language is: " . $_SESSION['favorite_programming_language'];

// However, like with cookies (and get/post parameters), it’s not guaranteed that the session variable exists. Better check first.
session_start();
if (isset($_SESSION["favorite_programming_language"])) {
    print "Your favorite programming language is: " . $_SESSION['favorite_programming_language'];
}

// This is also a handy way to check if the current user has permission to access certain content – if there’s the corresponding session variable (possibly with specific value), we’re good to go.
session_start();
if (isset($_SESSION["user_role"]) && $_SESSION["user_role"] == "admin") { // first check the variable is set or you may get an error
    // let’s show admin stuff here
}
```

### Destroying the session

If you want to destroy the session (e.g. when the user logs out), it requires two function calls. Note that you must have opened the session first with session_start(). If it’s not open, destroying it will silently fail. Calling session_start() after the session has been destroyed creates a new session.

```php
// This has to happen before we do anything with sessions. Even destroying.
session_start();

// remove all session variables
session_unset();

// destroy the session
session_destroy();
```

A long time ago, session_destroy() used to be enough, but nowadays the variables may continue to exist in the next session without session_unset(). Better safe than sorry.
